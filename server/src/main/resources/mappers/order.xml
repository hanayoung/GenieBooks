<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- name space는 BookRepo의 fully qualified name으로 설정한다. -->
<mapper namespace="com.ssafy.cafe.model.dao.OrderDao">
	<insert id="insert" parameterType="Order" 
	               useGeneratedKeys="true" keyProperty="id">
		INSERT INTO p_customer
			(c_id)
		VALUES
			(#{userId})
	</insert>

<!--r-->

	<select id="selectByUser" parameterType="string" resultType="Order">
		SELECT o_id as id
            , user_id
            , order_table
            , order_time
            , completed
        FROM t_order where user_id=#{userId} 
        order by o_id desc
	</select>


    <select id="selectOrderInfo" parameterType="int" resultMap="OrderResult">
        select
            o_id
            , c_id
            , o_date
            , is_done
        from p_customer

        where o_id = #{id};
    </select>



    <!-- 관통 프로젝트 6단계에서 추가됨 -->
    <select id="getLastMonthOrder" parameterType="string" resultType="Order">
        select
            o_id,
            c_id,
            o_date,
            is_done
        from p_customer

        where o_id = #{id} and order_time > date_add(now(), interval -1 month)
        order by o_id desc
    </select>

    <select id="getOrderDetailInfo" parameterType="int" resultType="OrderDetail">
       select
            c.o_id as order_id
            , c.c_id as user_id
            , b.quantity
        from p_customer c
        join p_book b on c.o_id = b.o_id
        order by order_id asc;
    </select>



<!--    &lt;!&ndash; 관통 프로젝트 6단계에서 추가됨 &ndash;&gt;-->
<!--    <select id="getLast6MonthOrder" parameterType="string"  resultMap="OrderResult">-->
<!--        select -->
<!--            o.o_id id-->
<!--            , o.user_id -->
<!--            , o.order_table-->
<!--            , o.order_time-->
<!--            , o.completed-->
<!--            , o.o_id as order_id-->
<!--        from t_order o -->

<!--        where user_id = #{id} and order_time > date_add(now(), interval -6 month)-->
<!--        order by o.o_id desc-->
<!--    </select>-->

    <resultMap id="OrderResult" type="OrderInfo">
        <collection property="details" javaType="ArrayList" column="o_id" ofType="OrderDetail"
         select="getOrderDetailInfo"/>
    </resultMap>
    
   


</mapper>